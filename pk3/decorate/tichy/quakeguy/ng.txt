actor " Quake NG ": Weapon replaces Shotgun
{
    Weapon.Kickback 100
    Weapon.SelectionOrder 5
    Weapon.AmmoUse 1
    Weapon.AmmoGive 30
    Weapon.AmmoType "QuakeNails"

    Weapon.SlotNumber 4

    +NOAUTOAIM
    +FLOATBOB

    Inventory.Icon "W_NGA0"
    Inventory.PickupMessage "You got the nailgun"
    Obituary "%o is nailed by %k"

    States
    {
      Deselect:
        TNT1 AAAAAAAAAAAAAAAAAAA 0 A_Lower
        PKCG A 1 A_Lower
        Loop

      Select:
        TNT1 AAAAAAAAAAAAAAAAAAA 0 A_Raise
        PKCG A 1 A_Raise
        Loop

      Ready:
        PKCG D 0 A_TakeInventory("NailgunFrame")
        PKCG A 1 A_WeaponReady
        Loop



      Fire:
        PKCG A 0 A_GunFlash
        PKCG A 0 A_PlaySound("weapons/pistol", CHAN_WEAPON)
        goto FireNail



      FireNail:
        PKCG A 0 A_JumpIfInventory("NailgunSide", 1, "NailRight")
        goto NailLeft


      NailLeft:
        PKCG A 0 A_FireCustomMissile("QuakeNail", 0, 1, -7)
        PKCG A 0 A_GiveInventory("NailgunSide")
        goto FireAnimate

      NailRight:
        PKCG A 0 A_FireCustomMissile("QuakeNail", 0, 1, 7)
        PKCG A 0 A_TakeInventory("NailgunSide")
        goto FireAnimate

      FireAnimate:
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 4, "FireFromA")
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 3, "FireFromD")
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 2, "FireFromC")
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 1, "FireFromB")
        goto FireFromA  // panic?

      FireFromA:
        PKCG A 1 bright A_Light1
        PKCG B 1 bright A_Light1
        PKCG C 1 bright A_Light0
        PKCG D 0 A_TakeInventory("NailgunFrame")
        PKCG D 0 A_GiveInventory("NailgunFrame", 3)
        PKCG D 0 A_Refire
        goto FireEnd

      FireFromB:
        PKCG B 1 bright A_Light1
        PKCG C 1 bright A_Light1
        PKCG D 1 bright A_Light0
        PKCG D 0 A_TakeInventory("NailgunFrame")
        PKCG D 0 A_GiveInventory("NailgunFrame", 4)
        PKCG D 0 A_Refire
        goto FireEnd

      FireFromC:
        PKCG C 1 bright A_Light1
        PKCG D 1 bright A_Light1
        PKCG A 1 bright A_Light0
        PKCG D 0 A_TakeInventory("NailgunFrame")
        PKCG D 0 A_GiveInventory("NailgunFrame", 1)
        PKCG D 0 A_Refire
        goto FireEnd

      FireFromD:
        PKCG D 1 bright A_Light1
        PKCG A 1 bright A_Light1
        PKCG B 1 bright A_Light0
        PKCG D 0 A_TakeInventory("NailgunFrame")
        PKCG D 0 A_GiveInventory("NailgunFrame", 2)
        PKCG D 0 A_Refire
        goto FireEnd

      FireEnd:
        PKCG A 0 A_Refire
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 4, "Ready")   // no need to play an end
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 3, "FireEndC")
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 2, "FireEndB")
        PKCG A 0 A_JumpIfInventory("NailgunFrame", 1, "FireEndA")
        goto Ready  // more panic?

      FireEndA:
        PKCG BC 1 A_WeaponReady
        PKCG C 0 A_GiveInventory("NailgunFrame", 1)
        PKCG CD 1 A_WeaponReady
        PKCG D 0 A_TakeInventory("NailgunFrame")
        PKCG DD 1 A_WeaponReady
        goto Ready

      FireEndB:
        PKCG CD 1 A_WeaponReady
        PKCG D 0 A_TakeInventory("NailgunFrame")
        PKCG D 1 A_WeaponReady
        goto Ready

      FireEndC:
        PKCG D 1 A_WeaponReady
        PKCG D 0 A_TakeInventory("NailgunFrame")
        goto Ready

      Flash:
        TNT1 A 2 A_Light2
        Goto LightDone

      Spawn:
        W_NG A -1 bright
        Stop
    }
}


actor QuakeNail
{
    Height 4
    Radius 4
    Speed 50

    Projectile
    Damage (10)

    +SPAWNSOUNDSOURCE

    Scale 0.15
    Translation "160:167=152:159", "168:191=157:159", "1:3=125:127", "144:151=126:126", "128:143=127:127", "78:78=0:0"

    States
    {
      Spawn:
        MISL A -1
        loop

      Death:
        TNT1 A 0 A_SpawnItemEx("BulletPuff", 0,0,0, 0,0,1)
        stop
    }
}

actor NailgunSide: Inventory
{
    inventory.maxamount 2
    +UNDROPPABLE
}

actor NailgunFrame: Inventory
{
    inventory.maxamount 4
    +UNDROPPABLE
}
